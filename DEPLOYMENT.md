# üöÄ Guide de D√©ploiement Complet

Ce guide vous accompagne √©tape par √©tape pour d√©ployer votre jeu Pierre-Papier-Ciseaux sur Farcaster.

## üì¶ √âtape 1 : Pr√©paration du Projet

### 1.1 Cloner et installer

```bash
# Cr√©er un nouveau projet
mkdir pierre-papier-ciseaux
cd pierre-papier-ciseaux

# Initialiser le projet
npm init -y

# Installer les d√©pendances
npm install next react react-dom ethers @vercel/og
npm install --save-dev typescript @types/node @types/react @types/react-dom
```

### 1.2 Structure des fichiers

```
pierre-papier-ciseaux/
‚îú‚îÄ‚îÄ contracts/
‚îÇ   ‚îî‚îÄ‚îÄ PierrePapierCiseauxSolo.sol
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îî‚îÄ‚îÄ deploy.js
‚îú‚îÄ‚îÄ pages/
‚îÇ   ‚îú‚îÄ‚îÄ index.tsx
‚îÇ   ‚îî‚îÄ‚îÄ api/
‚îÇ       ‚îú‚îÄ‚îÄ play.ts
‚îÇ       ‚îú‚îÄ‚îÄ create-profile.ts
‚îÇ       ‚îú‚îÄ‚îÄ leaderboard.ts
‚îÇ       ‚îî‚îÄ‚îÄ image/
‚îÇ           ‚îî‚îÄ‚îÄ [type].tsx
‚îú‚îÄ‚îÄ hardhat.config.js
‚îú‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ next.config.js
‚îú‚îÄ‚îÄ vercel.json
‚îú‚îÄ‚îÄ tsconfig.json
‚îî‚îÄ‚îÄ .env.local
```

## üîß √âtape 2 : D√©ployer le Smart Contract

### 2.1 Installer Hardhat

```bash
npm install --save-dev hardhat @nomicfoundation/hardhat-toolbox
npx hardhat init
# Choisir "Create a TypeScript project"
```

### 2.2 Configurer Hardhat

Cr√©ez `hardhat.config.js` avec la configuration fournie.

### 2.3 Obtenir une cl√© priv√©e

```bash
# IMPORTANT : Ne JAMAIS commit votre cl√© priv√©e !
# Cr√©ez un wallet de test sur MetaMask
# Exportez la cl√© priv√©e
```

### 2.4 Obtenir des fonds de test

Pour **Base Sepolia** (Testnet) :
1. Visitez : https://www.coinbase.com/faucet
2. Ou : https://bridge.base.org/
3. Obtenez des ETH Sepolia : https://sepoliafaucet.com

Pour **Optimism Sepolia** :
1. Visitez : https://www.alchemy.com/faucets/optimism-sepolia

### 2.5 Cr√©er le fichier .env

```bash
# √Ä la racine du projet
touch .env.local
```

Ajoutez :
```env
PRIVATE_KEY=votre_private_key_sans_0x
BASESCAN_API_KEY=votre_api_key
ALCHEMY_API_KEY=votre_api_key
```

### 2.6 D√©ployer le contrat

```bash
# Sur Base Sepolia (testnet recommand√©)
npx hardhat run scripts/deploy.js --network baseSepolia

# Ou sur Base Mainnet (production)
npx hardhat run scripts/deploy.js --network base

# Ou sur Optimism Sepolia
npx hardhat run scripts/deploy.js --network optimismSepolia
```

**Notez l'adresse du contrat d√©ploy√© !**

### 2.7 V√©rifier le contrat

```bash
npx hardhat verify --network baseSepolia ADRESSE_DU_CONTRAT
```

## üåê √âtape 3 : Configurer le Frontend

### 3.1 Mettre √† jour .env.local

Ajoutez ces variables :

```env
# Adresse du contrat d√©ploy√©
CONTRACT_ADDRESS=0xVOTRE_ADRESSE_CONTRAT

# RPC URL selon votre r√©seau
RPC_URL=https://sepolia.base.org

# URL temporaire pour le d√©veloppement local
NEXT_PUBLIC_URL=http://localhost:3000

# Cl√© priv√©e pour signer les transactions (cr√©ation de profil)
PRIVATE_KEY=votre_private_key
```

### 3.2 Tester localement

```bash
npm run dev
```

Visitez `http://localhost:3000` et v√©rifiez que :
- La page s'affiche correctement
- Les m√©tadonn√©es Frame sont pr√©sentes (voir le code source)

## üì° √âtape 4 : D√©ployer sur Vercel

### 4.1 Cr√©er un compte Vercel

1. Allez sur [vercel.com](https://vercel.com)
2. Connectez-vous avec GitHub
3. Cr√©ez un nouveau repository GitHub pour votre projet

### 4.2 Pousser le code sur GitHub

```bash
git init
git add .
git commit -m "Initial commit"
git branch -M main
git remote add origin https://github.com/VOTRE_USERNAME/VOTRE_REPO.git
git push -u origin main
```

### 4.3 Importer sur Vercel

1. Cliquez sur "New Project" dans Vercel
2. S√©lectionnez votre repository
3. Framework Preset : **Next.js**
4. Cliquez sur "Deploy"

### 4.4 Configurer les variables d'environnement

Dans Vercel Dashboard :
1. Allez dans **Settings** > **Environment Variables**
2. Ajoutez :

```
CONTRACT_ADDRESS = 0xVOTRE_ADRESSE
RPC_URL = https://sepolia.base.org
PRIVATE_KEY = votre_private_key
NEXT_PUBLIC_URL = https://votre-app.vercel.app
```

‚ö†Ô∏è **Important** : Pour `NEXT_PUBLIC_URL`, utilisez l'URL que Vercel vous a donn√©e.

### 4.5 Red√©ployer

Apr√®s avoir ajout√© les variables :
1. Allez dans **Deployments**
2. Cliquez sur les 3 points du dernier d√©ploiement
3. Cliquez sur "Redeploy"

## üß™ √âtape 5 : Tester la Frame

### 5.1 Utiliser le Frame Validator

1. Visitez : https://warpcast.com/~/developers/frames
2. Entrez votre URL Vercel : `https://votre-app.vercel.app`
3. V√©rifiez que :
   - L'image s'affiche
   - Les 4 boutons apparaissent (Pierre, Papier, Ciseaux, Stats)
   - Les clics fonctionnent

### 5.2 Tester les interactions

Cliquez sur chaque bouton et v√©rifiez :
- ‚úÖ **Pierre/Papier/Ciseaux** : L'image change et affiche le r√©sultat
- ‚úÖ **Stats** : Affiche vos statistiques
- ‚úÖ Navigation fluide entre les √©crans

### 5.3 V√©rifier sur la blockchain

1. Allez sur BaseScan : https://sepolia.basescan.org
2. Recherchez votre adresse de contrat
3. V√©rifiez les transactions dans l'onglet "Transactions"
4. V√©rifiez les √©v√©nements dans "Events"

## üì± √âtape 6 : Publier sur Farcaster

### 6.1 Cr√©er un cast

Dans Warpcast ou tout autre client Farcaster :

```
üéÆ Jouez √† Pierre-Papier-Ciseaux on-chain !

Statistiques, s√©ries de victoires, et classement global üèÜ

https://votre-app.vercel.app
```

### 6.2 La Frame devrait appara√Ætre automatiquement

Farcaster d√©tecte les m√©tadonn√©es Frame et affiche votre jeu directement dans le feed !

## üêõ R√©solution des Probl√®mes Courants

### Probl√®me : "Les images ne s'affichent pas"

**Solution** :
```bash
# V√©rifiez que @vercel/og est install√©
npm install @vercel/og

# V√©rifiez les logs Vercel
vercel logs
```

### Probl√®me : "Invalid frame message"

**Solution** :
- V√©rifiez que `untrustedData` et `trustedData` sont bien re√ßus
- Ajoutez des logs dans votre API route pour d√©bugger
- Testez avec le Frame Validator officiel

### Probl√®me : "Transaction failed"

**Solutions possibles** :
1. **Pas assez de gas** : Augmentez votre balance sur le testnet
2. **Profil d√©j√† cr√©√©** : Le contrat refuse si le profil existe d√©j√†
3. **RPC down** : Changez de provider RPC

```typescript
// Ajoutez plus de gas
const tx = await contract.creerProfil(playerName, {
  gasLimit: 500000
});
```

### Probl√®me : "Rate limit exceeded"

**Solution** :
Ajoutez un rate limiter avec Upstash :

```bash
npm install @upstash/ratelimit @upstash/redis
```

### Probl√®me : "CORS errors"

**Solution** :
V√©rifiez votre `next.config.js` :

```javascript
async headers() {
  return [
    {
      source: '/:path*',
      headers: [
        { key: 'Access-Control-Allow-Origin', value: '*' },
      ],
    },
  ];
}
```

## üîê S√©curit√© et Production

### Pour la production, vous devez :

1. **Ne jamais exposer PRIVATE_KEY dans le frontend**
2. **Utiliser un relayer pour les transactions gasless**
3. **Impl√©menter la validation des messages Farcaster**

```typescript
// Installation
npm install @farcaster/hub-nodejs

// Dans votre API route
import { Message, NobleEd25519Signer } from '@farcaster/hub-nodejs';

async function validateMessage(trustedData: string) {
  try {
    const frameMessage = Message.decode(Buffer.from(trustedData, 'hex'));
    // Valider le message
    return true;
  } catch (error) {
    return false;
  }
}
```

4. **Ajouter un syst√®me de rate limiting**
5. **Monitorer les transactions et les co√ªts**

## üìä Monitoring et Analytics

### Suivre l'utilisation

1. **Vercel Analytics** : Automatique avec Vercel
2. **Blockchain Explorer** : BaseScan/Optimism Explorer
3. **Custom Analytics** :

```typescript
// Ajoutez dans votre API route
const analytics = {
  totalPlays: 0,
  uniquePlayers: new Set(),
  winRate: 0
};

// Track chaque action
analytics.totalPlays++;
analytics.uniquePlayers.add(userAddress);
```

## üé® Personnalisation Avanc√©e

### Modifier les images

√âditez `pages/api/image/[type].tsx` :

```typescript
// Changez les couleurs
backgroundColor: '#VOTRE_COULEUR'
backgroundImage: 'linear-gradient(...)'

// Changez les emojis
const choices = ['üóø', 'üìã', '‚úÇÔ∏è']; // Autres emojis

// Ajoutez des animations (avec CSS)
style={{ animation: 'fadeIn 0.3s ease-in' }}
```

### Ajouter de nouveaux boutons

Dans vos API routes :

```typescript
<meta property="fc:frame:button:5" content="üèÜ Classement" />
<meta property="fc:frame:button:5:action" content="post" />
<meta property="fc:frame:button:5:target" content="${url}/api/leaderboard" />
```

### Ajouter des achievements

```solidity
// Dans le contrat
mapping(address => uint256[]) public achievements;

function checkAchievements(address player) internal {
  if (joueurs[player].victoires == 10) {
    achievements[player].push(1); // First blood
  }
  if (joueurs[player].meilleureSerie >= 5) {
    achievements[player].push(2); // Hot streak
  }
}
```

## üöÄ Am√©liorations Futures

### Id√©es √† impl√©menter :

1. **Mode multijoueur** : D√©fier d'autres joueurs
2. **NFT Rewards** : Mint des NFT pour les achievements
3. **Tournois** : Organiser des comp√©titions
4. **Paris** : Parier sur les r√©sultats
5. **Statistiques avanc√©es** : Graphiques, tendances
6. **Int√©gration avec d'autres protocoles** : ENS, Lens, etc.

## üìö Ressources Utiles

- [Farcaster Frames Documentation](https://docs.farcaster.xyz/learn/what-is-farcaster/frames)
- [Vercel Documentation](https://vercel.com/docs)
- [Base Documentation](https://docs.base.org)
- [Ethers.js Documentation](https://docs.ethers.org/)
- [Hardhat Documentation](https://hardhat.org/docs)

## ‚úÖ Checklist Finale

Avant de lancer en production :

- [ ] Contrat d√©ploy√© et v√©rifi√©
- [ ] Tests locaux passent
- [ ] Frame test√©e avec le validator
- [ ] Variables d'environnement configur√©es sur Vercel
- [ ] URLs mises √† jour partout
- [ ] Rate limiting impl√©ment√©
- [ ] Validation des messages Farcaster active
- [ ] Monitoring en place
- [ ] Documentation √† jour
- [ ] Cast publi√© sur Farcaster

## üéâ F√©licitations !

Votre jeu Pierre-Papier-Ciseaux est maintenant live sur Farcaster ! üöÄ

N'oubliez pas de :
- Partager votre Frame avec la communaut√©
- √âcouter les retours des utilisateurs
- It√©rer et am√©liorer
- Suivre les transactions et les co√ªts

Bon jeu ! üéÆ